var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},ps;(function(t){var e=function(){function t(){this.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}()}return t.prototype.animate=function(t){requestAnimationFrame.call(window,t.run.bind(t))},t}();t.BrowserAnimationFrameProvider=e})(ps||(ps={}));var ps;(function(t){var e=function(){function e(e){this.pos=e,this.vel=new t.Vector(0,0),this.acc=new t.Vector(0,0),this.isCollisionDetectionEnabled=!1,this.isAccelerationEnabled=!1,this.mass=100,this.destroyed=!1,this.isWrapping=!1}return e.prototype.update=function(t,e){this.isAccelerationEnabled&&(this.vel=this.vel.add(this.acc.multiply(t))),this.pos=this.pos.add(this.vel.multiply(t)),this.isWrapping&&this.wrap(e)},e.prototype.wrap=function(t){this.pos.x>t.x&&(this.pos.x-=t.x),0>this.pos.x&&(this.pos.x+=t.x),0>this.pos.y&&(this.pos.y+=t.y),this.pos.y>t.y&&(this.pos.y-=t.y)},e.prototype.collideWith=function(){},e}();t.Entity=e})(ps||(ps={}));var ps;(function(t){var e;(function(t){var e=function(){function t(){for(var t=[],e=0;arguments.length>e;e++)t[e-0]=arguments[e];this.entities=t}return t}();t.Collision=e})(e=t.collision||(t.collision={}))})(ps||(ps={}));var ps;(function(t){var e;(function(t){var e=function(){function e(){}return e.prototype.findCollisions=function(e){for(var i=this.getCollisionEnabledEntities(e),n=[],o=0;i.length-1>o;o++)for(var s=o+1;i.length>s;s++)this.collides(i[o],i[s])&&n.push(new t.Collision(i[o],i[s]));return n},e.prototype.collides=function(t,e){return t.pos.distanceTo(e.pos)<t.radius+e.radius},e.prototype.getCollisionEnabledEntities=function(t){return t.filter(function(t){return t.isCollisionDetectionEnabled})},e}();t.CircularCollisionDetector=e})(e=t.collision||(t.collision={}))})(ps||(ps={}));var ps;(function(t){var e;(function(t){var e=function(){function t(){}return t.prototype.resolve=function(t){for(var e=0,i=t;i.length>e;e++){var n=i[e];this.resolveSingleCollision(n)}},t.prototype.resolveSingleCollision=function(t){for(var e=t.entities,i=0;e.length-1>i;i++)for(var n=i+1;e.length>n;n++)e[i].collideWith(e[n]),e[n].collideWith(e[i])},t}();t.DeferToEntityCollisionResolver=e})(e=t.collision||(t.collision={}))})(ps||(ps={}));var ps;(function(t){var e=function(){function e(t,e){this.x=t,this.y=e}return e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.subtract=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.distanceTo=function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))},e.prototype.toVector=function(){return new t.Vector(this.x,this.y)},e}();t.Point=e})(ps||(ps={}));var ps;(function(t){var e;(function(t){var e=function(){function t(t){var e=this;this.pressedKeys={},this.document=t,this.keyDownDelegate=function(t){return e.setKey(t,!0)}.bind(this),this.keyUpDelegate=function(t){return e.setKey(t,!1)}.bind(this),this.blurDelegate=function(){return e.pressedKeys={}}.bind(this)}return t.prototype.enable=function(){document.addEventListener("keydown",this.keyDownDelegate),document.addEventListener("keyup",this.keyUpDelegate),window.addEventListener("blur",this.keyUpDelegate)},t.prototype.disable=function(){document.removeEventListener("keydown",this.keyDownDelegate),document.removeEventListener("keyup",this.keyUpDelegate),window.removeEventListener("blur",this.keyUpDelegate)},t.prototype.isKeyDown=function(t){return this.pressedKeys[t.toUpperCase()]},t.prototype.setKey=function(t,e){var i,n=t.keyCode;switch(n){case 32:i="SPACE";break;case 37:i="LEFT";break;case 38:i="UP";break;case 39:i="RIGHT";break;case 40:i="DOWN";break;default:i=String.fromCharCode(n)}this.pressedKeys[i]=e},t}();t.Keyboard=e})(e=t.input||(t.input={}))})(ps||(ps={}));var ps;(function(t){var e;(function(e){var i=function(){function e(e){this.pos=new t.Point(0,0),this.isLeftButtonDown=!1,this.isRightButtonDown=!1,this.isMiddleButtonDown=!1,this.canvas=e,this.mouseMoveDelegate=this.onMouseMove.bind(this),this.mouseDownDelegate=this.onMouseDown.bind(this),this.mouseUpDelegate=this.onMouseUp.bind(this)}return e.prototype.enable=function(){document.body.oncontextmenu=function(){return!1},this.canvas.style.cursor="none",this.canvas.addEventListener("mousemove",this.mouseMoveDelegate,!1),this.canvas.addEventListener("mousedown",this.mouseDownDelegate,!1),this.canvas.addEventListener("mouseup",this.mouseUpDelegate,!1)},e.prototype.disable=function(){document.body.oncontextmenu=function(){return!0},this.canvas.style.cursor="default",this.canvas.removeEventListener("mousemove",this.mouseMoveDelegate,!1),this.canvas.removeEventListener("mousedown",this.mouseDownDelegate,!1),this.canvas.removeEventListener("mouseup",this.mouseUpDelegate,!1)},e.prototype.onMouseMove=function(e){var i=new t.Point(e.clientX,e.clientY);this.pos=i.subtract(this.findPos(this.canvas))},e.prototype.onMouseDown=function(t){t.stopImmediatePropagation(),0===t.button?this.isLeftButtonDown=!0:1===t.button?this.isRightButtonDown=!0:2===t.button&&(this.isMiddleButtonDown=!0)},e.prototype.onMouseUp=function(t){t.stopImmediatePropagation(),0===t.button?this.isLeftButtonDown=!1:1===t.button?this.isRightButtonDown=!1:2===t.button&&(this.isMiddleButtonDown=!1)},e.prototype.findPos=function(e){var i=0,n=0;if(e.offsetParent)do i+=e.offsetLeft,n+=e.offsetTop;while(e=e.offsetParent);return new t.Point(i,n)},e}();e.Mouse=i})(e=t.input||(t.input={}))})(ps||(ps={}));var ps;(function(t){var e=function(){function t(){this.start()}return t.prototype.start=function(){this.startTime=Date.now()},t.prototype.stop=function(){return(Date.now()-this.startTime)/1e3},t}();t.DateNowStopwatch=e})(ps||(ps={}));var ps;(function(t){t.collision;var e=function(){function e(e,i,n,o,s){this.dims=e,this.canvas=i,this.mouse=n,this.keyboard=o,this.animator=s,this.debug=!1,this.backgroundFillStyle="black",this.collisionDetector=new t.collision.CircularCollisionDetector,this.collisionResolver=new t.collision.DeferToEntityCollisionResolver,this.stopwatch=new t.DateNowStopwatch,this.entities=[],this.ctx=i.getContext("2d"),this.mouse&&this.mouse.enable(),this.keyboard&&this.keyboard.enable()}return e.prototype.registerEntity=function(){for(var t=[],e=0;arguments.length>e;e++)t[e-0]=arguments[e];for(var i=0,n=t;n.length>i;i++){var o=n[i];this.entities.push(o)}},e.prototype.run=function(){Date.now();var t=this.stopwatch.stop();this.garbageCollect(),this.update(t,this.entities),this.checkCollisions(this.entities),this.render(this.entities),this.stopwatch.start(),this.animator.animate(this)},e.prototype.start=function(){this.animator.animate(this)},e.prototype.checkCollisions=function(t){var e=this.collisionDetector.findCollisions(t);this.collisionResolver.resolve(e)},e.prototype.update=function(t,e){for(var i=0,n=e;n.length>i;i++){var o=n[i];o.update(t,this.dims)}},e.prototype.render=function(t){this.clearFrame(this.ctx);for(var e=0,i=t;i.length>e;e++){var n=i[e];n.render(this.ctx)}},e.prototype.clearFrame=function(t){t.fillStyle=this.backgroundFillStyle,t.fillRect(0,0,this.dims.x,this.dims.y)},e.prototype.garbageCollect=function(){this.entities=this.entities.filter(function(t){return!t.destroyed})},e}();t.HeadlessEngine=e;var i=function(e){function i(i,n){e.call(this,i,n,new t.input.Mouse(n),new t.input.Keyboard(document,window),new t.BrowserAnimationFrameProvider)}return __extends(i,e),i}(e);t.Engine=i})(ps||(ps={}));var ps;(function(t){var e=function(){function t(){this.cache={},this.readyCallbacks=[]}return t.prototype.preload=function(t){for(var e=this,i=function(t){if(!n.cache[t]){var i=new Image;i.onload=function(){if(e.cache[t]=i,e.isReady())for(var n=0,o=e.readyCallbacks;o.length>n;n++){var s=o[n];s()}},n.cache[t]=!1,i.src=t}},n=this,o=0,s=t;s.length>o;o++){var r=s[o];i(r)}},t.prototype.get=function(t){return this.cache[t]},t.prototype.onReady=function(t){this.readyCallbacks.push(t)},t.prototype.isReady=function(){for(var t in this.cache)if(this.cache.hasOwnProperty(t)&&!this.cache[t])return!1;return!0},t}();t.ResourceManager=e})(ps||(ps={}));var ps;(function(t){var e=function(){function t(t,e,i,n,o){this.spriteSheetCoordinates=t,this.spriteSize=e,this.frames=i,this.animationSpeed=n,this.url=o,this.index=0,this.index=Math.random()*i.length}return t.prototype.update=function(t){this.index=this.index+this.animationSpeed*t%this.frames.length},t.prototype.render=function(t,e,i,n,o){var s=0;if(this.animationSpeed>0){var r=Math.floor(this.index);s=this.frames[r%this.frames.length]}var a=this.spriteSheetCoordinates.x+s*this.spriteSize[0],u=this.spriteSheetCoordinates.y;0===o?t.drawImage(e.get(this.url),a,u,this.spriteSize[0],this.spriteSize[1],i[0]-n[0]/2,i[1]-n[1]/2,n[0],n[1]):(t.translate(i[0],i[1]),t.rotate(o),t.drawImage(e.get(this.url),a,u,this.spriteSize[0],this.spriteSize[1],-n[0]/2,-n[1]/2,n[0],n[1]),t.rotate(-o),t.translate(-i[0],-i[1]))},t}();t.Sprite=e})(ps||(ps={}));var ps;(function(t){var e=function(t){function e(){t.apply(this,arguments),this.sprites=[]}return __extends(e,t),e.prototype.update=function(e,i){t.prototype.update.call(this,e,i);for(var n=0,o=this.sprites;o.length>n;n++){var s=o[n];s.update(e)}},e}(t.Entity);t.EntityWithSprites=e})(ps||(ps={}));var ps;(function(t){var e=function(){function e(t,e){this.x=t,this.y=e}return e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.subtract=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.multiply=function(t){return new e(this.x*t,this.y*t)},e.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},e.prototype.unit=function(){return this.multiply(1/this.magnitude())},e.prototype.tangent=function(){return new e(0===this.y?0:-1*this.y,this.x)},e.prototype.dot=function(t){return this.x*t.x+this.y*t.y},e.prototype.toPoint=function(){return new t.Point(this.x,this.y)},e}();t.Vector=e})(ps||(ps={}));