/*! piston - v0.3.0 - 2016-06-20
* https://github.com/martinfaartoft/piston/
* Copyright (c) 2016 Piston.js <martin.faartoft@gmail.com>; Licensed MIT*/
var __extends=this&&this.__extends||function(t,i){function n(){this.constructor=t}for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e]);t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)},ps;(function(t){var i=function(){function t(){this.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}()}return t.prototype.animate=function(t){requestAnimationFrame.call(window,t.run.bind(t))},t}();t.BrowserAnimationFrameProvider=i})(ps||(ps={}));var ps;(function(t){var i=function(){function i(i){this.pos=i,this.vel=new t.Vector(0,0),this.acc=new t.Vector(0,0),this.isCollisionDetectionEnabled=!1,this.isAccelerationEnabled=!1,this.mass=100,this.destroyed=!1,this.isWrapping=!1}return i.prototype.update=function(t,i){this.isAccelerationEnabled&&(this.vel=this.vel.add(this.acc.multiply(t))),this.pos=this.pos.add(this.vel.multiply(t)),this.isWrapping&&this.wrap(i)},i.prototype.wrap=function(t){this.pos.x>t.x&&(this.pos.x-=t.x),0>this.pos.x&&(this.pos.x+=t.x),0>this.pos.y&&(this.pos.y+=t.y),this.pos.y>t.y&&(this.pos.y-=t.y)},i.prototype.collideWith=function(){},i}();t.Entity=i})(ps||(ps={}));var ps;(function(t){var i;(function(t){var i=function(){function t(){for(var t=[],i=0;arguments.length>i;i++)t[i-0]=arguments[i];this.entities=t}return t}();t.Collision=i})(i=t.collision||(t.collision={}))})(ps||(ps={}));var ps;(function(t){var i;(function(t){var i=function(){function i(){}return i.prototype.findCollisions=function(i){for(var n=this.getCollisionEnabledEntities(i),e=[],o=0;n.length-1>o;o++)for(var s=o+1;n.length>s;s++)this.collides(n[o],n[s])&&e.push(new t.Collision(n[o],n[s]));return e},i.prototype.collides=function(t,i){return t.pos.distanceTo(i.pos)<t.radius+i.radius},i.prototype.getCollisionEnabledEntities=function(t){return t.filter(function(t){return t.isCollisionDetectionEnabled})},i}();t.CircularCollisionDetector=i})(i=t.collision||(t.collision={}))})(ps||(ps={}));var ps;(function(t){var i;(function(t){var i=function(){function t(){}return t.prototype.resolve=function(t){for(var i=0,n=t;n.length>i;i++){var e=n[i];this.resolveSingleCollision(e)}},t.prototype.resolveSingleCollision=function(t){for(var i=t.entities,n=0;i.length-1>n;n++)for(var e=n+1;i.length>e;e++)i[n].collideWith(i[e]),i[e].collideWith(i[n])},t}();t.DeferToEntityCollisionResolver=i})(i=t.collision||(t.collision={}))})(ps||(ps={}));var ps;(function(t){t.collision;var i=function(){function i(i,n,e){this.dims=i,this.ctx=n,this.animator=e,this.debug=!1,this.backgroundFillStyle="black",this.collisionDetector=new t.collision.CircularCollisionDetector,this.collisionResolver=new t.collision.DeferToEntityCollisionResolver,this.lastTime=Date.now(),this.entities=[]}return i.prototype.registerEntity=function(){for(var t=[],i=0;arguments.length>i;i++)t[i-0]=arguments[i];for(var n=0,e=t;e.length>n;n++){var o=e[n];this.entities.push(o)}},i.prototype.run=function(){var t=Date.now(),i=(t-this.lastTime)/1e3;this.garbageCollect(),this.update(i,this.entities),this.checkCollisions(this.entities),this.render(this.entities),this.lastTime=t,this.animator.animate(this)},i.prototype.start=function(){this.animator.animate(this)},i.prototype.checkCollisions=function(t){var i=this.collisionDetector.findCollisions(t);this.collisionResolver.resolve(i)},i.prototype.update=function(t,i){for(var n=0,e=i;e.length>n;n++){var o=e[n];o.update(t,this.dims)}},i.prototype.render=function(t){this.clearFrame(this.ctx);for(var i=0,n=t;n.length>i;i++){var e=n[i];e.render(this.ctx)}},i.prototype.clearFrame=function(t){t.fillStyle=this.backgroundFillStyle,t.fillRect(0,0,this.dims.x,this.dims.y)},i.prototype.garbageCollect=function(){this.entities=this.entities.filter(function(t){return!t.destroyed})},i}();t.HeadlessEngine=i;var n=function(i){function n(n,e){i.call(this,n,e,new t.BrowserAnimationFrameProvider)}return __extends(n,i),n}(i);t.Engine=n})(ps||(ps={}));var ps;(function(t){var i=function(){function t(){this.cache={},this.readyCallbacks=[]}return t.prototype.preload=function(t){for(var i=this,n=function(t){if(!e.cache[t]){var n=new Image;n.onload=function(){if(i.cache[t]=n,i.isReady())for(var e=0,o=i.readyCallbacks;o.length>e;e++){var s=o[e];s()}},e.cache[t]=!1,n.src=t}},e=this,o=0,s=t;s.length>o;o++){var r=s[o];n(r)}},t.prototype.get=function(t){return this.cache[t]},t.prototype.onReady=function(t){this.readyCallbacks.push(t)},t.prototype.isReady=function(){for(var t in this.cache)if(this.cache.hasOwnProperty(t)&&!this.cache[t])return!1;return!0},t}();t.ResourceManager=i})(ps||(ps={}));var ps;(function(t){var i=function(){function i(t,i){this.x=t,this.y=i}return i.prototype.add=function(t){return new i(this.x+t.x,this.y+t.y)},i.prototype.distanceTo=function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))},i.prototype.toVector=function(){return new t.Vector(this.x,this.y)},i}();t.Point=i})(ps||(ps={}));var ps;(function(t){var i=function(){function t(t,i,n,e,o){this.spriteSheetCoordinates=t,this.spriteSize=i,this.frames=n,this.animationSpeed=e,this.url=o,this.index=0,this.index=Math.random()*n.length}return t.prototype.update=function(t){this.index=this.index+this.animationSpeed*t%this.frames.length},t.prototype.render=function(t,i,n,e,o){var s=0;if(this.animationSpeed>0){var r=Math.floor(this.index);s=this.frames[r%this.frames.length]}var a=this.spriteSheetCoordinates.x+s*this.spriteSize[0],c=this.spriteSheetCoordinates.y;0===o?t.drawImage(i.get(this.url),a,c,this.spriteSize[0],this.spriteSize[1],n[0]-e[0]/2,n[1]-e[1]/2,e[0],e[1]):(t.translate(n[0],n[1]),t.rotate(o),t.drawImage(i.get(this.url),a,c,this.spriteSize[0],this.spriteSize[1],-e[0]/2,-e[1]/2,e[0],e[1]),t.rotate(-o),t.translate(-n[0],-n[1]))},t}();t.Sprite=i})(ps||(ps={}));var ps;(function(t){var i=function(t){function i(){t.apply(this,arguments),this.sprites=[]}return __extends(i,t),i.prototype.update=function(i,n){t.prototype.update.call(this,i,n);for(var e=0,o=this.sprites;o.length>e;e++){var s=o[e];s.update(i)}},i}(t.Entity);t.EntityWithSprites=i})(ps||(ps={}));var ps;(function(t){function i(t){return n[t.toUpperCase()]}t.isKeyDown=i;var n={};(function(){function t(t,i){var e,o=t.keyCode;switch(o){case 32:e="SPACE";break;case 37:e="LEFT";break;case 38:e="UP";break;case 39:e="RIGHT";break;case 40:e="DOWN";break;default:e=String.fromCharCode(o)}n[e]=i}document.addEventListener("keydown",function(i){t(i,!0)}),document.addEventListener("keyup",function(i){t(i,!1)}),window.addEventListener("blur",function(){n={}})})()})(ps||(ps={}));var ps;(function(t){var i=function(){function i(t,i){this.x=t,this.y=i}return i.prototype.add=function(t){return new i(this.x+t.x,this.y+t.y)},i.prototype.subtract=function(t){return new i(this.x-t.x,this.y-t.y)},i.prototype.multiply=function(t){return new i(this.x*t,this.y*t)},i.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},i.prototype.unit=function(){return this.multiply(1/this.magnitude())},i.prototype.tangent=function(){return new i(0===this.y?0:-1*this.y,this.x)},i.prototype.dot=function(t){return this.x*t.x+this.y*t.y},i.prototype.toPoint=function(){return new t.Point(this.x,this.y)},i}();t.Vector=i})(ps||(ps={}));