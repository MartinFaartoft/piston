/*! piston - v0.1.1 - 2016-06-17
* https://github.com/martinfaartoft/piston/
* Copyright (c) 2016 Piston.js <martin.faartoft@gmail.com>; Licensed MIT*/
var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},ps;(function(t){var e=function(){function t(){this.cache={},this.readyCallbacks=[]}return t.prototype.preload=function(t){for(var e=this,i=function(t){if(!s.cache[t]){var i=new Image;i.onload=function(){if(e.cache[t]=i,e.isReady())for(var s=0,n=e.readyCallbacks;n.length>s;s++){var r=n[s];r()}},s.cache[t]=!1,i.src=t}},s=this,n=0,r=t;r.length>n;n++){var o=r[n];i(o)}},t.prototype.get=function(t){return this.cache[t]},t.prototype.onReady=function(t){this.readyCallbacks.push(t)},t.prototype.isReady=function(){for(var t in this.cache)if(this.cache.hasOwnProperty(t)&&!this.cache[t])return!1;return!0},t}();t.ResourceManager=e})(ps||(ps={}));var ps;(function(t){var e=function(){function t(t){this.dimensions=t}return t}();t.BaseGameState=e})(ps||(ps={}));var ps;(function(t){var e=function(){function t(t,e,i){this.state=t,this.ctx=e,this.debug=i,this.lastTime=Date.now(),this.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}()}return t.prototype.run=function(){var t=Date.now(),e=(t-this.lastTime)/1e3;this.state.update(e),this.state.render(this.ctx),this.lastTime=t,this.requestAnimationFrame.call(window,this.run.bind(this))},t}();t.Engine=e})(ps||(ps={}));var ps;(function(t){var e=function(){function t(t,e,i){this.pos=t,this.speed=e,this.radius=i,this.destroyed=!1}return t.prototype.update=function(t,e){this.pos[0]+=this.speed[0]*t,this.pos[1]+=this.speed[1]*t,this.wrap(e.dimensions)},t.prototype.wrap=function(t){this.pos[0]>t[0]&&(this.pos[0]-=t[0]),0>this.pos[0]&&(this.pos[0]+=t[0]),0>this.pos[1]&&(this.pos[1]+=t[1]),this.pos[1]>t[1]&&(this.pos[1]-=t[1])},t.prototype.getWrappedBoundingCircles=function(t){for(var e=[this],i=-1;1>=i;i++)for(var s=-1;1>=s;s++)e.push({pos:[this.pos[0]+i*t[0],this.pos[1]+s*t[1]],radius:this.radius,entity:this});return e},t}();t.Entity=e})(ps||(ps={}));var ps;(function(t){var e=function(){function t(t,e,i,s,n){this.spriteSheetCoordinates=t,this.spriteSize=e,this.frames=i,this.speed=s,this.url=n,this.index=0,this.index=Math.random()*i.length}return t.prototype.update=function(t){this.index=this.index+this.speed*t%this.frames.length},t.prototype.render=function(t,e,i,s,n){var r=0;if(this.speed>0){var o=Math.floor(this.index);r=this.frames[o%this.frames.length]}var a=this.spriteSheetCoordinates[0]+r*this.spriteSize[0],p=this.spriteSheetCoordinates[1];0===n?t.drawImage(e.get(this.url),a,p,this.spriteSize[0],this.spriteSize[1],i[0]-s[0]/2,i[1]-s[1]/2,s[0],s[1]):(t.translate(i[0],i[1]),t.rotate(n),t.drawImage(e.get(this.url),a,p,this.spriteSize[0],this.spriteSize[1],-s[0]/2,-s[1]/2,s[0],s[1]),t.rotate(-n),t.translate(-i[0],-i[1]))},t}();t.Sprite=e})(ps||(ps={}));var ps;(function(t){var e=function(t){function e(e,i,s){t.call(this,e,i,s),this.sprites=[]}return __extends(e,t),e.prototype.update=function(e,i){t.prototype.update.call(this,e,i);for(var s=0,n=this.sprites;n.length>s;s++){var r=n[s];r.update(e)}},e}(t.Entity);t.EntityWithSprites=e})(ps||(ps={}));var ps;(function(t){function e(t){return i[t.toUpperCase()]}t.isKeyDown=e;var i={};(function(){function t(t,e){var s,n=t.keyCode;switch(n){case 32:s="SPACE";break;case 37:s="LEFT";break;case 38:s="UP";break;case 39:s="RIGHT";break;case 40:s="DOWN";break;default:s=String.fromCharCode(n)}i[s]=e}document.addEventListener("keydown",function(e){t(e,!0)}),document.addEventListener("keyup",function(e){t(e,!1)}),window.addEventListener("blur",function(){i={}})})()})(ps||(ps={}));var ps;(function(t){function e(t,e,i){var s=t.pos[0]-e.pos[0],n=t.pos[1]-e.pos[1],r=Math.sqrt(s*s+n*n),o=t.radius+e.radius>r;return o&&(t.collideWith(e,i),e.collideWith(t,i)),o}t.detectCircularCollision=e})(ps||(ps={}));