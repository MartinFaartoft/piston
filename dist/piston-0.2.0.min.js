/*! piston - v0.2.0 - 2016-06-19
* https://github.com/martinfaartoft/piston/
* Copyright (c) 2016 Piston.js <martin.faartoft@gmail.com>; Licensed MIT*/
var __extends=this&&this.__extends||function(t,i){function e(){this.constructor=t}for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n]);t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)},ps;(function(t){var i=function(){function t(){this.cache={},this.readyCallbacks=[]}return t.prototype.preload=function(t){for(var i=this,e=function(t){if(!n.cache[t]){var e=new Image;e.onload=function(){if(i.cache[t]=e,i.isReady())for(var n=0,s=i.readyCallbacks;s.length>n;n++){var r=s[n];r()}},n.cache[t]=!1,e.src=t}},n=this,s=0,r=t;r.length>s;s++){var o=r[s];e(o)}},t.prototype.get=function(t){return this.cache[t]},t.prototype.onReady=function(t){this.readyCallbacks.push(t)},t.prototype.isReady=function(){for(var t in this.cache)if(this.cache.hasOwnProperty(t)&&!this.cache[t])return!1;return!0},t}();t.ResourceManager=i})(ps||(ps={}));var ps;(function(t){var i=function(){function i(t,i){this.x=t,this.y=i}return i.prototype.add=function(t){return new i(this.x+t.x,this.y+t.y)},i.prototype.subtract=function(t){return new i(this.x-t.x,this.y-t.y)},i.prototype.multiply=function(t){return new i(this.x*t,this.y*t)},i.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},i.prototype.unit=function(){return this.multiply(1/this.magnitude())},i.prototype.tangent=function(){return new i(0===this.y?0:-1*this.y,this.x)},i.prototype.dot=function(t){return this.x*t.x+this.y*t.y},i.prototype.toPoint=function(){return new t.Point(this.x,this.y)},i}();t.Vector=i})(ps||(ps={}));var ps;(function(t){var i=function(){function t(t){this.dimensions=t}return t}();t.BaseGameState=i})(ps||(ps={}));var ps;(function(t){var i=function(){function t(t,i,e){this.state=t,this.ctx=i,this.debug=e,this.lastTime=Date.now(),this.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}()}return t.prototype.run=function(){var t=Date.now(),i=(t-this.lastTime)/1e3;this.state.update(i),this.state.render(this.ctx),this.lastTime=t,this.requestAnimationFrame.call(window,this.run.bind(this))},t}();t.Engine=i})(ps||(ps={}));var ps;(function(t){var i=function(){function t(t,i,e){this.pos=t,this.speed=i,this.radius=e,this.destroyed=!1,this.isWrapping=!1}return t.prototype.update=function(t,i){this.pos=this.pos.add(this.speed.multiply(t)),this.isWrapping&&this.wrap(i.dimensions)},t.prototype.wrap=function(t){this.pos.x>t.x&&(this.pos.x-=t.x),0>this.pos.x&&(this.pos.x+=t.x),0>this.pos.y&&(this.pos.y+=t.y),this.pos.y>t.y&&(this.pos.y-=t.y)},t.prototype.getWrappedBoundingCircles=function(t){for(var i=[this],e=-1;1>=e;e++)for(var n=-1;1>=n;n++)i.push({pos:[this.pos[0]+e*t[0],this.pos[1]+n*t[1]],radius:this.radius,entity:this});return i},t}();t.Entity=i})(ps||(ps={}));var ps;(function(t){var i=function(){function i(t,i){this.x=t,this.y=i}return i.prototype.add=function(t){return new i(this.x+t.x,this.y+t.y)},i.prototype.distanceTo=function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))},i.prototype.toVector=function(){return new t.Vector(this.x,this.y)},i}();t.Point=i})(ps||(ps={}));var ps;(function(t){var i=function(){function t(t,i,e,n,s){this.spriteSheetCoordinates=t,this.spriteSize=i,this.frames=e,this.speed=n,this.url=s,this.index=0,this.index=Math.random()*e.length}return t.prototype.update=function(t){this.index=this.index+this.speed*t%this.frames.length},t.prototype.render=function(t,i,e,n,s){var r=0;if(this.speed>0){var o=Math.floor(this.index);r=this.frames[o%this.frames.length]}var a=this.spriteSheetCoordinates[0]+r*this.spriteSize[0],p=this.spriteSheetCoordinates[1];0===s?t.drawImage(i.get(this.url),a,p,this.spriteSize[0],this.spriteSize[1],e[0]-n[0]/2,e[1]-n[1]/2,n[0],n[1]):(t.translate(e[0],e[1]),t.rotate(s),t.drawImage(i.get(this.url),a,p,this.spriteSize[0],this.spriteSize[1],-n[0]/2,-n[1]/2,n[0],n[1]),t.rotate(-s),t.translate(-e[0],-e[1]))},t}();t.Sprite=i})(ps||(ps={}));var ps;(function(t){var i=function(t){function i(){t.apply(this,arguments),this.sprites=[]}return __extends(i,t),i.prototype.update=function(i,e){t.prototype.update.call(this,i,e);for(var n=0,s=this.sprites;s.length>n;n++){var r=s[n];r.update(i)}},i}(t.Entity);t.EntityWithSprites=i})(ps||(ps={}));var ps;(function(t){function i(t){return e[t.toUpperCase()]}t.isKeyDown=i;var e={};(function(){function t(t,i){var n,s=t.keyCode;switch(s){case 32:n="SPACE";break;case 37:n="LEFT";break;case 38:n="UP";break;case 39:n="RIGHT";break;case 40:n="DOWN";break;default:n=String.fromCharCode(s)}e[n]=i}document.addEventListener("keydown",function(i){t(i,!0)}),document.addEventListener("keyup",function(i){t(i,!1)}),window.addEventListener("blur",function(){e={}})})()})(ps||(ps={}));var ps;(function(t){function i(t,i,e){var n=t.pos.distanceTo(i.pos),s=t.radius+i.radius>n;return s&&(t.collideWith(i,e),i.collideWith(t,e)),s}t.detectCircularCollision=i})(ps||(ps={}));